<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}">
  <head>
    <meta charset="UTF-8">
    <title>{{ page.title | default: site.title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#001f3f">
    <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
    
    <!-- Schema.org structured data -->
    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ResearchProject",
  "name": "Synoetic OS Research Hub",
  "alternateName": "Mythopoeic Intelligence Architecture",
  "description": "{{ site.description }}",
  "url": "{{ site.url }}{{ site.baseurl }}",
  "author": {
    "@type": "Person",
    "name": "{{ site.author }}",
    "identifier": "{{ site.orcid }}"
  },
  "keywords": "AI Resilience, Cognitive Architecture, Mythopoeic Intelligence, Predictive Myelination"
}
    </script>
    
    <style>
      /* Citation box styling */
      .citation-box { 
        background: #f4f4f4; 
        padding: 15px; 
        border-radius: 5px; 
        position: relative; 
        margin: 20px 0; 
        font-family: monospace; 
        font-size: 0.9em; 
        border-left: 4px solid #001f3f;
      }
      .copy-btn { 
        position: absolute; 
        top: 10px; 
        right: 10px; 
        padding: 5px 10px; 
        background: #001f3f; 
        color: white; 
        border: none; 
        border-radius: 3px; 
        cursor: pointer; 
        font-size: 0.85em;
      }
      .copy-btn:hover { 
        background: #FFD700; 
        color: #001f3f; 
      }
      .copy-btn:active {
        transform: scale(0.95);
      }
      
      /* Mermaid diagram container */
      .mermaid {
        display: flex;
        justify-content: center;
        margin: 2rem 0;
        background-color: #f8f9fa;
        padding: 1.5rem;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
      }
      
      .mermaid svg {
        max-width: 100%;
        height: auto;
      }
    </style>
  </head>
  <body>
    <header class="page-header" role="banner">
      <h1 class="project-name">{{ page.title | default: site.title }}</h1>
      <h2 class="project-tagline">{{ page.description | default: site.description | default: site.github.project_tagline }}</h2>
      {% if site.github.is_project_page %}
        <a href="{{ site.github.repository_url }}" class="btn">View on GitHub</a>
      {% endif %}
      {% if page.paper_title %}
        <a href="{{ site.baseurl }}/" class="btn">← Research Hub</a>
      {% endif %}
    </header>

    <main id="content" class="main-content" role="main">
      {{ content }}

      <!-- Citation section (only show for papers) -->
      {% if page.paper_title %}
      <section class="academic-citation">
        <hr>
        <h3>Cite this Research</h3>
        <div class="citation-box" id="bibtex-block">
@article{slusher2026{{ page.paper_title | slugify | remove: "-" | truncate: 20, "" }},
  title={ {{- page.paper_title -}} },
  {% if page.paper_subtitle %}subtitle={ {{- page.paper_subtitle -}} },{% endif %}
  author={Slusher, Aaron M.},
  year={2026},
  {% if page.doi %}doi={ {{- page.doi -}} },{% endif %}
  url={ {{- site.url -}}{{- site.baseurl -}}{{- page.url -}} },
  note={ORCID: 0009-0000-9923-3207}
}
          <button class="copy-btn" onclick="copyBibtex()">Copy BibTeX</button>
        </div>
        
        {% if page.zenodo %}
        <p class="doi-link">
          <strong>Zenodo DOI:</strong> 
          <a href="{{ page.zenodo }}" target="_blank">{{ page.doi }}</a>
        </p>
        {% endif %}
        
        <p class="additional-links">
          <a href="{{ site.huggingface }}" target="_blank">Hugging Face Hub</a> | 
          <a href="{{ site.github.repository_url }}" target="_blank">GitHub Source</a> |
          <a href="{{ site.orcid }}" target="_blank">ORCID Profile</a>
          {% if page.zenodo %} | <a href="{{ page.zenodo }}" target="_blank">Zenodo Record</a>{% endif %}
        </p>
      </section>
      {% endif %}

      <footer class="site-footer">
        {% if site.github.is_project_page %}
          <span class="site-footer-owner"><a href="{{ site.github.repository_url }}">{{ site.github.repository_name }}</a> is maintained by <a href="{{ site.github.owner_url }}">{{ site.github.owner_name }}</a>.</span>
        {% endif %}
        <span class="site-footer-credits">Generated by <a href="https://pages.github.com">GitHub Pages</a> | © 2026 Aaron M. Slusher, ValorGrid Solutions</span>
      </footer>
    </main>

    <!-- CONDITIONAL MERMAID LOADING - Only load if page.mermaid is true -->
    {% if page.mermaid %}
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
      
      // Initialize without auto-start to prevent conflicts
      mermaid.initialize({ 
        startOnLoad: false, 
        theme: 'neutral', 
        securityLevel: 'loose',
        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'
      });

      // Universal Mermaid render: handles both <div class="mermaid"> and ```mermaid code blocks
      document.addEventListener('DOMContentLoaded', async () => {
        const selector = 'div.mermaid, pre code.language-mermaid';
        const blocks = document.querySelectorAll(selector);

        for (let i = 0; i < blocks.length; i++) {
          const el = blocks[i];
          const rawText = el.textContent.trim();
          
          // Create clean container for SVG
          const container = document.createElement('div');
          container.className = 'mermaid';
          container.id = `mermaid-diagram-${i}`;
          container.textContent = rawText;

          // Replace old element with clean container
          if (el.tagName === 'CODE') {
            el.parentElement.replaceWith(container);
          } else {
            el.replaceWith(container);
          }
        }
        
        // Render all diagrams
        try {
          await mermaid.run();
          console.log('Mermaid diagrams rendered successfully');
        } catch (error) {
          console.error('Mermaid rendering error:', error);
        }
      });
    </script>
    {% endif %}

    <!-- BibTeX copy function -->
    <script>
      function copyBibtex() {
        const block = document.getElementById('bibtex-block');
        const text = block.textContent.replace('Copy BibTeX', '').trim();
        
        navigator.clipboard.writeText(text).then(() => {
          const btn = event.target;
          const originalText = btn.textContent;
          btn.textContent = '✓ Copied!';
          btn.style.background = '#27ae60';
          
          setTimeout(() => { 
            btn.textContent = originalText;
            btn.style.background = '#001f3f';
          }, 2000);
        }).catch(err => {
          console.error('Copy failed:', err);
          alert('Failed to copy. Please select and copy manually.');
        });
      }
    </script>
  </body>
</html>
